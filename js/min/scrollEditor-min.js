function init(){for(var t=document.getElementById("presetBox"),e=0;e<presetArray.length;e++)t.innerHTML=t.innerHTML+"<img src='"+presetArray[e]+"' style='cursor: pointer;' id='preset-"+e+"' class='col-3' height='80' alt='preset image' />"}function getBackScroll(){return document.getElementById("faction").value+"_"+document.getElementById("rarity").value+".png"}function setBackScroll(){scrollBack.src="img/scrollEditor/card/"+getBackScroll(),scrollFactionIcon.src="img/scrollEditor/icons/"+document.getElementById("faction").value+".png",scrollBack.onload=function(){drawScroll(!0)},scrollFactionIcon.onload=function(){drawScroll(!0)}}function getCostNumber(){return"y"+document.getElementById("cost").value+".png"}function checkStatsBar(){var t=document.getElementById("stats"),e=document.getElementById("subtype").value;"CREATURE"==e||"STRUCTURE"==e?t.style.display="block":t.style.display="none"}function drawScroll(t){1==t&&(clearCVS(),context.drawImage(scrollArt,artX,artY,scrollArt.width,scrollArt.height),context.clearRect(0,0,50,canvas.height),context.clearRect(350,0,canvas.width,canvas.height),context.clearRect(0,0,canvas.width,100),context.clearRect(0,canvas.height-100,canvas.width,100),updateDraggDot()),context.drawImage(scrollBack,0,23,scroll.w*scroll.s,scroll.h*scroll.s-23),1!=document.getElementById("foil").value&&context.drawImage(scrollFoil,0,23,scroll.w*scroll.s,scroll.h*scroll.s-23),context.drawImage(scrollCostBox,130,-2,scrollCostBox.width,scrollCostBox.width*costBoxRatio+10),context.drawImage(scrollFactionIcon,150,9,48,48),context.drawImage(scrollCost,197,12,scrollCost.width,scrollCost.width*costNumberRation),context.font="35px axe",context.fillStyle=textColor,scrollNameWidth=context.measureText(scrollName),context.fillText(scrollName,canvas.width/2-scrollNameWidth.width/2,95),context.font="24px axe";var e="";if(token&&(e+="TOKEN "),e+=subtype,0!=subsubtype.length&&(e+=": "+subsubtype),scrollSubtypeWidth=context.measureText(e),context.fillText(e,canvas.width/2-scrollSubtypeWidth.width/2,120),("CREATURE"==subtype||"STRUCTURE"==subtype)&&(context.drawImage(scrollStatsBox,50,307,scrollStatsBox.width,scrollStatsBox.width*statBoxRatio),context.drawImage(scrollAttackStat,105,328,scrollAttackStat.width,scrollAttackStat.width*attackRatio),context.drawImage(scrollCountdownStat,188,328,scrollCountdownStat.width,scrollCountdownStat.width*countdownRatio),context.drawImage(scrollHealthStat,275,328,scrollHealthStat.width,scrollHealthStat.width*healthRatio)),isFlavor){context.font="21px honeyitalic",flavorTextArray=document.getElementById("flavor").value.split("\n");for(var o=0;o<flavorTextArray.length;o++){var l=context.measureText(flavorTextArray[o]);context.fillText(flavorTextArray[o],canvas.width/2-l.width/2,520+lineHight*o)}}else scrollButton.width=230,context.drawImage(scrollButton,80,515,scrollButton.width,scrollButton.width/4),scrollButtonText=document.getElementById("button").value,scrollButtonTextWisth=context.measureText(scrollButtonText),context.fillStyle=textLightColor,context.fillText(scrollButtonText,canvas.width/2-scrollButtonTextWisth.width/2,550),context.fillStyle=textColor;for(var r=document.getElementById("description").value.split("\n"),c=0,o=0;o<r.length;o++){r[o].match(/^\[t\]/im)?(r[o]=r[o].replace(/\[t\]/gi,""),context.font="21px honeyitalic"):context.font="21px honey";for(var n=r[o].split(" "),a=0;a<n.length;a++)n[a].match(/<.*?>/im)?(n[a]=n[a].replace(/[\<\>]/gim,""),context.fillStyle=keywordColor):context.fillStyle=textColor,context.fillText(n[a],c+60,393+lineHight*o),WordW=context.measureText(n[a]),c+=WordW.width+wordSpacing;c=0}}function clearCVS(){context.clearRect(0,0,canvas.width,canvas.height)}function updateDraggDot(){draggDot.style.top=canvas.offsetTop+artY+scrollArt.height-draggDot.style.height/2+"px",draggDot.style.left=canvas.offsetLeft+artX+scrollArt.width-draggDot.style.width/2+"px"}function updateDraggDotXY(t,e){draggDot.style.top=e+"px",draggDot.style.left=t+"px"}function updateArtImage(){scrollArt.src=document.getElementById("artUrl").value,scrollArt.onload=function(){artRatio=scrollArt.height/scrollArt.width,scrollArt.width>=300&&(scrollArt.width=300,scrollArt.height=artRatio*scrollArt.width),clearCVS(),drawScroll(!0)}}function changeBtnAndFlavor(t){isFlavor=t;var e=document.getElementById("flavorBtn"),o=document.getElementById("buttonBtn"),l=document.getElementById("flavorTextBox"),r=document.getElementById("buttonTextBox");t?(e.className="btn success",o.className="btn",l.style.display="block",r.style.display="none"):(o.className="btn success",e.className="btn",r.style.display="block",l.style.display="none"),drawScroll(!0)}var canvas=document.getElementById("scroll"),scroll={s:.6,w:633,h:1024};canvas.width=633*scroll.s,canvas.height=1024*scroll.s+23;var dragging=!1,context=canvas.getContext("2d"),draggDot=document.getElementById("dragg"),scrollBack=new Image;scrollBack.src="img/scrollEditor/card/"+getBackScroll();var scrollArt=new Image;scrollArt.src="http://scrolldier.com/resources/cardImages/501.png";var scrollCostBox=new Image;scrollCostBox.src="img/scrollEditor/box/costbox.png";var scrollFactionIcon=new Image;scrollFactionIcon.src="img/scrollEditor/icons/growth.png";var scrollCost=new Image;scrollCost.src="img/scrollEditor/numbers/y0.png";var scrollButton=new Image;scrollButton.src="img/scrollEditor/box/clickType.png";var scrollStatsBox=new Image;scrollStatsBox.src="img/scrollEditor/box/statsbox.png";var scrollAttackStat=new Image;scrollAttackStat.src="img/scrollEditor/numbers/"+document.getElementById("attack").value+".png";var scrollCountdownStat=new Image;scrollCountdownStat.src="img/scrollEditor/numbers/"+document.getElementById("countdown").value+".png";var scrollHealthStat=new Image;scrollHealthStat.src="img/scrollEditor/numbers/"+document.getElementById("health").value+".png";var scrollFoil=new Image,artRatio=.75,lineHight=22,wordSpacing=5,keywordColor="#38576B",textColor="#351C0C",textLightColor="#f8f8f8",rotationDeg=0,costBoxRatio,costNumberRation,statBoxRatio,attackRatio,countdownRatio,healthRatio,scrollName="Eager to Battle",flavorText,isFlavor=!0,subtype=document.getElementById("subtype").value,token=!1,subsubtype=document.getElementById("subsubtype").value,scrollSubtypeWidth,artX=50,artY=scroll.h*scroll.s/5.5,presetArray=["http://scrolldier.com/resources/cardImages/spoilerArt/e.png","http://scrolldier.com/resources/cardImages/spoilerArt/o.png","http://scrolldier.com/resources/cardImages/spoilerArt/g.png","http://scrolldier.com/resources/cardImages/spoilerArt/d.png","http://scrolldier.com/resources/cardImages/spoilerArt/w.png","http://scrolldier.com/resources/cardImages/spoilerArt/s.png","http://scrolldier.com/resources/cardImages/spoilerArt/scholar_1.png","http://scrolldier.com/resources/cardImages/spoilerArt/2.png","http://scrolldier.com/resources/cardImages/spoilerArt/eb.png","http://scrolldier.com/resources/cardImages/spoilerArt/bell.png","http://scrolldier.com/resources/cardImages/spoilerArt/lipbling.png","https://s3.amazonaws.com/f.cl.ly/items/1U3e390d052D2d3t1c0e/Skjermbilde%202015-02-16%20kl.%2022.20.24.png"];init();for(var i=0;i<presetArray.length;i++)document.querySelector("#preset-"+i).addEventListener("click",function(){document.getElementById("artUrl").value=this.src,updateArtImage()});scrollArt.onload=function(){artRatio=scrollArt.height/scrollArt.width,drawScroll(!0)},scrollBack.onload=function(){drawScroll(!0)},scrollFoil.onload=function(){drawScroll(!0)},scrollButton.onload=function(){drawScroll(!0)};var numberWidth=25;scrollAttackStat.onload=function(){attackRatio=scrollAttackStat.height/scrollAttackStat.width,scrollAttackStat.width=numberWidth,drawScroll(!0)},scrollCountdownStat.onload=function(){countdownRatio=scrollCountdownStat.height/scrollCountdownStat.width,scrollCountdownStat.width=numberWidth,drawScroll(!0)},scrollHealthStat.onload=function(){healthRatio=scrollHealthStat.height/scrollHealthStat.width,scrollHealthStat.width=numberWidth,drawScroll(!0)},scrollCostBox.onload=function(){costBoxRatio=scrollCostBox.height/scrollCostBox.width,scrollCostBox.width=125,drawScroll(!0)},scrollFactionIcon.onload=function(){drawScroll(!0)},scrollCost.onload=function(){costNumberRation=scrollCost.height/scrollCost.width,scrollCost.width=30,drawScroll(!0)},scrollStatsBox.onload=function(){statBoxRatio=scrollStatsBox.height/scrollStatsBox.width,scrollStatsBox.width=285,drawScroll(!0)},document.getElementById("faction").addEventListener("change",function(){setBackScroll()}),document.getElementById("foil").addEventListener("change",function(){1!=this.value?(scrollFoil.src="img/scrollEditor/foil/"+this.value+".png",scrollFoil.onload=function(){drawScroll(!0)}):(scrollFoil.src="",drawScroll(!0))}),document.getElementById("subsubtype").addEventListener("keyup",function(){subsubtype=this.value,drawScroll(!0)}),document.getElementById("subtype").addEventListener("change",function(){subtype=this.value,checkStatsBar(),drawScroll(!0)}),document.getElementById("attack").addEventListener("change",function(){scrollAttackStat.src="img/scrollEditor/numbers/"+this.value+".png",scrollAttackStat.onload=function(){drawScroll(!0)}}),document.getElementById("countdown").addEventListener("change",function(){scrollCountdownStat.src="img/scrollEditor/numbers/"+this.value+".png",scrollCountdownStat.onload=function(){drawScroll(!0)}}),document.getElementById("button").addEventListener("keyup",function(){drawScroll(!0)}),document.getElementById("health").addEventListener("change",function(){scrollHealthStat.src="img/scrollEditor/numbers/"+this.value+".png",scrollHealthStat.onload=function(){drawScroll(!0)}}),document.getElementById("token").addEventListener("click",function(){token=!token,token?this.className="btn success":this.className="btn",drawScroll(!0)}),document.getElementById("description").addEventListener("keyup",function(){drawScroll(!0)}),document.getElementById("rarity").addEventListener("change",function(){setBackScroll()}),document.getElementById("name").addEventListener("keyup",function(){scrollName=this.value,drawScroll(!0)}),document.getElementById("flavor").addEventListener("keyup",function(){flavorText=this.value,drawScroll(!0)}),document.getElementById("cost").addEventListener("change",function(){scrollCost.src="img/scrollEditor/numbers/"+getCostNumber(),scrollCost.onload=function(){drawScroll(!0)}}),canvas.addEventListener("mousedown",function(t){dragging=!0,mouseE=t,document.addEventListener("mousemove",function(t){dragging&&(clearCVS(),artX+=t.pageX-mouseE.pageX,artY+=t.pageY-mouseE.pageY,updateDraggDot(),mouseE=t,context.drawImage(scrollArt,artX,artY,scrollArt.width,scrollArt.height),context.clearRect(0,0,50,canvas.height),context.clearRect(350,0,canvas.width,canvas.height),context.clearRect(0,0,canvas.width,100),context.clearRect(0,canvas.height-100,canvas.width,100),drawScroll())})}),document.addEventListener("mouseup",function(){dragging=!1});var draggDotDragg=!1,mouseXE,shiftIsDown;document.addEventListener("keydown",function(t){16==t.keyCode&&(shiftIsDown=!0)}),document.addEventListener("keyup",function(t){shiftIsDown=!1}),draggDot.addEventListener("mousedown",function(t){draggDotDragg=!0,mouseXE=t,document.addEventListener("mousemove",function(t){if(draggDotDragg){if(clearCVS(),shiftIsDown){var e=t.pageX-mouseXE.pageX;scrollArt.width=scrollArt.width+e,scrollArt.height=artRatio*scrollArt.width}else scrollArt.height+=t.pageY-mouseXE.pageY,scrollArt.width+=t.pageX-mouseXE.pageX;updateDraggDot(t.pageX,t.pageY),mouseXE=t,drawScroll(!0)}})}),document.addEventListener("mouseup",function(t){draggDotDragg=!1}),draggDot.addEventListener("mouseup",function(t){draggDotDragg=!1}),document.getElementById("artPlus").addEventListener("click",function(){scrollArt.width+=20,scrollArt.height=scrollArt.width*artRatio,clearCVS(),drawScroll(!0),updateDraggDot()}),document.getElementById("artMinus").addEventListener("click",function(){scrollArt.width-=20,scrollArt.height=scrollArt.width*artRatio,clearCVS(),drawScroll(!0),updateDraggDot()}),document.getElementById("updateArt").addEventListener("click",function(){updateArtImage()}),document.getElementById("flavorBtn").addEventListener("click",function(){changeBtnAndFlavor(!0)}),document.getElementById("buttonBtn").addEventListener("click",function(){changeBtnAndFlavor(!1)}),document.getElementById("presetBtn").addEventListener("click",function(){var t=document.getElementById("presetBox");"block"==t.style.display?t.style.display="none":t.style.display="block"});