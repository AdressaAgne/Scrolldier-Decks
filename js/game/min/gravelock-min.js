$(function(){function e(e,t){return Math.random()*(t-e)+e}function t(){g(),m.totalUnits=m.units.length,m.totalSpells=m.spells.length;for(var e=0;e<m.totalUnits;e++)0==e?$("#units").append(a(e,!1)):(m.units[e].price=m.units[0].price*Math.pow(m.unitPriceMultiplyer,e),m.units[e].tier2=m.units[0].price*Math.pow(m.unitPriceMultiplyer,e)*3,m.units[e].tier3=m.units[0].price*Math.pow(m.unitPriceMultiplyer,e)*9,m.units[e].basePrice=m.units[0].price*Math.pow(m.unitPriceMultiplyer,e),$("#units").append(a(e,!0)));for(var e=0;e<m.totalSpells;e++)$("#spells").append(r(e,!1));setInterval(c,m.gameTick),l()}function a(e,t){var t=t?"hidden":"",a=m.units[e],r=a.desc?a.desc:"",c='<div class="col-4 '+t+'" id="level-'+e+'"><div class="col-12 game-unit"><h4>'+a.name+' <small style="color: #CE0000" class="value-'+e+'"></small></h4><div class="col-6"><h1 id="count-'+e+'" style="padding: 50px;">0</h1></div><div class="col-6 align-center game-unit-image-container"><img src="/img/gravelock/'+(e+1)+'.png" class="game-unit-game" alt="" /><h3><span id="ap-'+e+'">'+a.ap+'</span> - <span id="cd-'+e+'">'+a.cd+'</span> - <span id="hp-'+e+'">'+a.hp+'</span></h3></div><div class="form-element align-center"><button id="summon-'+e+'" data-level="'+e+'" class="btn">Summon '+a.shortName+' <span class="price">('+n(a.price,"","")+'g)</span></button><div class="col-12"><button id="xTimes-5-'+e+'" data-level="'+e+'" data-times="5" class="btn">x5 <span class="price">('+n(d(a.price,5),"","")+'g)</span></button><button id="xTimes-25-'+e+'" data-level="'+e+'" data-times="25" class="btn">x25 <span class="price">('+n(d(a.price,25),"","")+'g)</span></button><button id="xTimes-100-'+e+'" data-level="'+e+'" data-times="100" class="btn">x100 <span class="price">('+n(d(a.price,100),"","")+'g)</span></button></div><div class="align-center col-12" id="raw-'+e+'"></div><p id="desc-'+e+'"class="align-center col-12">'+r+'</p><p style="color: #ffeb04;" id="bonus-'+e+'" class="align-center col-12"></p></div></div></div>';return c}function r(e,t){var t=t?"hidden":"",a=m.spells[e],r=a.desc?a.desc:"",c='<div class="col-4 '+t+'" id="spell-level-'+e+'"><div class="col-12 game-spell"><h4>'+a.name+'</h4><div class="col-12 align-center"><img src="/img/gravelock/s'+(e+1)+'.png" alt="" /></div><div class="form-element align-center"><button id="cast-'+e+'" data-level="'+e+'" class="btn">Cast '+a.shortName+' <span class="price">('+n(a.price,""," ")+m.player.resouceName[a.resource]+')</span></button><p id="spell-desc-'+e+'"class="align-center col-12">'+r+'</p><p style="color: #ffeb04;" id="spell-bonus-'+e+'" class="align-center col-12"></p></div></div></div>';return c}function c(){for(var e=0,t=0,a=m.gameTick/m.gameSpeed,r=0;r<m.totalUnits;r++)e+=m.units[r].ap/a/(m.units[r].cd/a)*m.units[r].count,t+=m.units[r].ap/m.units[r].cd*m.units[r].count;m.player.gold+=e/(m.player.idolHealth/a)*m.player.idolKillReward,m.player.goldSec=Math.round(t/m.player.idolHealth*m.player.idolKillReward);for(var r=0;r<m.totalUnits;r++){var c=m.units[r];c.count>0&&c.clockEffect&&"function"==typeof c.clockEffect&&($("#bonus-"+r).text("Bonus: "+c.clockEffect(c.count)),c.hasIdle&&(m.idle?$("#desc-"+r).find(".effect").css("color","#88b837"):$("#desc-"+r).find(".effect").css("color","#CE0000")))}m.clock++;for(var r=0;r<m.totalSpells;r++){var o=m.spells[r];o.cooldown&&!o.cooldown<=0&&o.cooldown--,o.clockEffect&&"function"==typeof o.clockEffect&&$("#spell-bonus-"+r).text("Cooldown: "+o.clockEffect())}m.clock>=m.clockReset&&(m.idle=!0,m.clock=0),l()}function o(e){e?($("#game-gold").removeClass("col-6"),$("#game-gold").addClass("col-4"),$("#game-dps").removeClass("col-6"),$("#game-dps").addClass("col-4"),$("#game-res").show()):($("#game-gold").removeClass("col-4"),$("#game-gold").addClass("col-6"),$("#game-dps").removeClass("col-4"),$("#game-dps").addClass("col-6"),$("#game-res").hide())}function l(){var e=Math.round(m.player.gold),t=m.player.goldSec;$("#gold").text(n(e,""," g")+" "+n(t,"(","g/Sec)"));for(var a=0,r=0;r<m.totalSpells;r++){var c=m.spells[r];s(m.player.res.energy,"#cast-"+r,c.price,!1)}m.player.res.energy>0&&o(!0),$("#res-energy").text(n(m.player.res.energy,"",""));for(var r=0;r<m.totalUnits;r++){var l=m.units[r];$("#count-"+r).text(n(l.count,"","x"));var i=l.ap/l.cd*l.count;a+=i,$(".value-"+r).text(n(i,""," DPS")),$("#raw-"+r).text(l.ap/l.cd+" Raw DPS"),$("#ap-"+r).text(l.ap),$("#cd-"+r).text(l.cd),$("#hp-"+r).text(l.hp),$("#summon-"+r).find(".price").text(n(Math.round(l.price),"(","g)")),$("#xTimes-5-"+r).find(".price").text(n(Math.round(d(l.price,5)),"(","g)")),$("#xTimes-25-"+r).find(".price").text(n(Math.round(d(l.price,25)),"(","g)")),$("#xTimes-100-"+r).find(".price").text(n(Math.round(d(l.price,100)),"(","g)")),s(m.player.gold,"#summon-"+r,l.price,!1),s(m.player.gold,"#xTimes-5-"+r,d(l.price,5),!0),s(m.player.gold,"#xTimes-25-"+r,d(l.price,25),!0),s(m.player.gold,"#xTimes-100-"+r,d(l.price,100),!0),l.count>0&&$("#level-"+(r+1))&&$("#level-"+(r+1)).show()}$("#total_dps").html(m.idle?n(a,""," DPS <span style='color: #88b837'>(Idle)</span>"):n(a,""," DPS"))}function s(e,t,a,r){e>=a?($(t).addClass("success"),$(t).removeClass("danger"),r&&$(t).show()):($(t).removeClass("success"),$(t).addClass("danger"),r&&$(t).hide())}function n(e,t,a){for(var r=["","k","m","b","t","Qa","Qi","Sx","Sp","Oc","No","De","Un","Du"],c=r.length;c>0;c--)if(e>Math.pow(10,3*c+1))return t+Math.round(e/Math.pow(10,3*c)*10)/10+r[c]+a;return t+Math.round(e)+a}function i(){if(m.debugMode){m.debugMode=!1,m.priceMultiplyer=1.15;for(var e=0;e<m.totalUnits;e++)m.units[e].price=m.units[e].basePrice}else{m.debugMode=!0,m.priceMultiplyer=0;for(var e=0;e<m.totalUnits;e++)m.units[e].price=0}}function d(e,t){var a=m.priceMultiplyer;t=parseInt(t);var r=e*Math.pow(a,t+.5-1)/Math.log(a)-e*Math.pow(a,-0.5)/Math.log(a);return r}function p(e,t,a){var r=m.units[e];if(t>1)var c=parseInt(d(r.price,t,"",""));else var c=parseInt(r.price);if(m.player.gold>=c||a){for(var e=0;e<m.totalUnits;e++){var o=m.units[e];o.clock&&(o.clock=0)}r.count+=t,a||(m.player.gold-=c,m.idle=!1,m.clock=0),t>1?r.price=r.price*Math.pow(m.priceMultiplyer,t):r.price*=m.priceMultiplyer,r.effect&&"function"==typeof r.effect&&r.effect(r.effectValue*t),$(this).find(".price").text(n(d(r.price,t),"(","g)")),l()}}function u(e,t){var a=m.spells[e];(m.player.res.energy>=a.price||t)&&(t||(m.idle=!1,m.clock=0,a.cooldown?a.cooldown<=0&&(m.player.res.energy-=a.price):m.player.res.energy-=a.price),a.effect&&"function"==typeof a.effect&&a.effect(),l())}function f(){for(var e={player:m.player,units:[]},t=0;t<m.totalUnits;t++){var a={price:m.units[t].price,ap:m.units[t].ap,cd:m.units[t].cd,hp:m.units[t].hp,count:m.units[t].count};e.units[t]=a}$.ajax({type:"POST",url:"/view/admin/ajax/gravelock.php",data:{json:e}}).done(function(e){e?(console.log("Game saved"+e),$("#save-notify").text("Game Saved"),$("#save-game").addClass("success"),$("#save-game").removeClass("danger"),setTimeout(function(){$("#save-game").addClass("danger"),$("#save-game").removeClass("success")},5e3)):console.log("Error while saving game: "+e)}).fail(function(){console.log("Failed while saving game, with error: "+data),$("#save-notify").text("Failed to save Game")}).always(function(e){console.log("Request done.")})}function g(){$.ajax({type:"POST",url:"/view/admin/ajax/gravelock_load.php",data:{json:JSON}}).done(function(e){if(e){if(e.length>10){console.log("Game Loaded "+e),e=jQuery.parseJSON(e),console.log(e),m.player.gold=parseInt(e.player.gold),m.player.res.energy=parseInt(e.player.res.energy);for(var t=0;t<m.totalUnits;t++)m.units[t].price=parseInt(e.units[t].price),m.units[t].ap=parseInt(e.units[t].ap),m.units[t].cd=parseInt(e.units[t].cd),m.units[t].hp=parseInt(e.units[t].hp),m.units[t].count=parseInt(e.units[t].count);$("#save-notify").text("Game Loaded")}m.gameLoaded=!0}else console.log("Error while saving game: ")}).fail(function(){console.log("Failed while saving game, with error: "+data)}).always(function(e){console.log("Request done.")})}var v={growth:0,energy:1,decay:2,order:3,wild:4},m=function(){var t={gameTick:100,gameSpeed:1e3,priceMultiplyer:1.15,unitPriceMultiplyer:6,totalUnits:0,totalSpells:0,debugMode:!1,idle:!1,gameLoaded:!1,clock:0,clockReset:100,player:{level:0,gold:3,idol:0,goldSec:0,idolHealth:10,idolKillReward:20,res:{growth:0,energy:0,decay:0,order:0,wild:0},resouceName:{0:"Growth",1:"Energy",3:"Decay",4:"Order",5:"Wild"}},units:[{name:"Gravelock Raider",shortName:"Raider",elderBoost:!0,tier1:0,tier2:1e3,tier3:3e3,price:3,basePrice:3,ap:1,cd:2,hp:2,count:0,round:0},{name:"Gravelock Guard",shortName:"Guard",elderBoost:!0,tier1:1e3,tier2:3e3,tier3:9e3,price:18,basePrice:18,ap:2,cd:2,hp:3,count:0,round:0},{name:"Gravelock Outcast",shortName:"Outcast",elderBoost:!0,tier1:3e3,tier2:9e3,tier3:27e3,price:108,basePrice:18,ap:3,cd:2,hp:3,count:0,round:0},{name:"Lockling Brood",shortName:"Locklings",elderBoost:!0,tier1:6e3,tier2:18e3,tier3:54e3,price:648,basePrice:18,ap:4,cd:1,hp:4,count:0,round:0},{name:"Gravelock Freak",shortName:"Freak",elderBoost:!0,tier1:6e3,tier2:18e3,tier3:54e3,price:3888,basePrice:18,ap:3,cd:2,hp:6,count:0,round:0,desc:"Deals additional damage per round equal to its health.",clockEffect:function(e){var a=t.units[4],r=a.hp/a.cd,c=t.gameTick/t.gameSpeed,o=r/(t.player.idolHealth/c)*t.player.idolKillReward;return t.player.gold+=o,n(r,"","DPS")}},{name:"Gravelock Elder",shortName:"Elder",effectValue:1,tier1:6e3,tier2:18e3,tier3:54e3,price:23328,basePrice:18,ap:3,cd:2,hp:5,count:0,round:0,desc:"Increases attack and health of all Gravelocks by 1.",effect:function(e){for(var a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap+=parseInt(e),r.hp+=parseInt(e))}}},{name:"Uhu Longnose",shortName:"Uhu",elderBoost:!0,effectValue:2,tier:1,tier1:6e3,tier2:18e3,tier3:54e3,price:139968,basePrice:18,ap:2,cd:2,hp:4,count:0,round:0,desc:"Increases your gold each round by the number of units you control.",clockEffect:function(e){for(var a=0,r=0;r<t.totalUnits;r++){var c=t.units[r];a+=c.count*e}return a-=t.units[6].count,t.player.gold+=a/10,n(a,"","G/s")}},{name:"Snargl",shortName:"Snargl",tier1:6e3,tier2:18e3,tier3:54e3,price:839808,basePrice:18,ap:4,cd:2,hp:5,count:0,round:0,hasIdle:!0,desc:"<span class='effect' style='color: #ffeb04;'>[Idle]</span>: Attack increases by 10",clockEffect:function(e){var a=t.units[7];return t.idle?(a.ap=14,"+"+10*a.count+" Attack"):(a.ap=4,"0 Attack")}},{name:"Snargl Omelette",shortName:"Omelette",tier:1,tier1:6e3,tier2:18e3,tier3:54e3,price:5038848,basePrice:18,ap:0,cd:15,hp:4,count:0,round:0,clock:0,clockReset:150,lastUnit:"",desc:"Spawns a random Unit of lower level every 15 sec",clockEffect:function(a){var r=t.units[8];if(r.clock++,r.clock>=r.clockReset){var c=parseInt(e(0,7));r.lastUnit=r.count+"x "+t.units[c].name,p(c,r.count,!0),r.clock=0}var o=parseInt((r.clockReset-r.clock)/10)+1;return r.lastUnit+" ("+o+"s)"}},{name:"Desert Memorial",shortName:"Memorial",tier:1,tier1:0,tier2:0,tier3:0,price:0,basePrice:0,ap:0,cd:3,hp:4,count:0,round:0,clock:0,clockReset:100,lastUnit:"",desc:"Increase Energy by 1, every 10 sec",clockEffect:function(e){var a=t.units[9];a.clock++,a.clock>=a.clockReset&&(t.player.res.energy+=a.count,a.clock=0);var r=parseInt((a.clockReset-a.clock)/10)+1;return"+"+a.count+" Energy ("+r+"s)"}},{name:"Sand Pack Memorial",shortName:"Memorial",tier:1,tier1:0,tier2:0,tier3:0,price:0,basePrice:0,ap:0,cd:3,hp:4,count:0,round:0,clock:0,clockReset:50,lastUnit:"",desc:"Increase Energy by 5, every 5 sec",clockEffect:function(e){var a=t.units[10];a.clock++,a.clock>=a.clockReset&&(t.player.res.energy+=5*a.count,a.clock=0);var r=parseInt((a.clockReset-a.clock)/10)+1;return"+"+5*a.count+" Energy ("+r+"s)"}}],spells:[{name:"Gravelock Burrows",shortName:"Burrows",tier:1,tier2:0,tier3:0,price:30,resource:v.energy,basePrice:0,desc:"All Gravelocks get +3 Attack",effect:function(){for(var e=t.spells[0],a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap+=3)}}},{name:"Power Trip",shortName:"Power Trip",tier:1,tier2:0,tier3:0,price:10,resource:v.energy,basePrice:0,cooldown:600,cooldownReset:600,desc:"<span style='color: #ffeb04;'>[Cooldown]</span> Increase Energy by 20",effect:function(){var e=t.spells[1];e.cooldown<=0&&(t.player.res.energy+=20,e.cooldown=e.cooldownReset)},clockEffect:function(){var e=t.spells[1];return e.cooldown<=0?"Ready":parseInt(e.cooldown/10)+1+"sec"}},{name:"Fodder Pit",shortName:"Fodder Pit",tier:1,tier2:0,tier3:0,price:1e3,resource:v.energy,basePrice:0,desc:"Double Gravelocks Attack",effect:function(){for(var e=t.spells[2],a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap*=2)}}}]};return t}();t(),setInterval(function(){m.gameLoaded&&f()},6e5),$("#debug").click(function(){i()}),$("[id*=cast-]").click(function(){var e=parseInt($(this).attr("data-level"));u(e,!1)}),$("[id*=summon-]").click(function(){var e=parseInt($(this).attr("data-level"));p(e,1,!1)}),$("[id*=xTimes-]").click(function(){var e=parseInt($(this).attr("data-level")),t=parseInt($(this).attr("data-times"));p(e,t,!1)}),$("#save-game").click(function(){f()})});