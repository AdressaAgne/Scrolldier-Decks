$(function(){function e(e,t){return Math.random()*(t-e)+e}function t(){g(),h.totalUnits=h.units.length,h.totalSpells=h.spells.length;for(var e=0;e<h.totalUnits;e++)0==e?$("#units").append(a(e,!1)):(h.units[e].price=h.units[0].price*Math.pow(h.unitPriceMultiplyer,e),h.units[e].tier2=h.units[0].price*Math.pow(h.unitPriceMultiplyer,e)*3,h.units[e].tier3=h.units[0].price*Math.pow(h.unitPriceMultiplyer,e)*9,h.units[e].basePrice=h.units[0].price*Math.pow(h.unitPriceMultiplyer,e),$("#units").append(a(e,!0)));for(var e=0;e<h.totalSpells;e++)$("#spells").append(r(e,!1));setInterval(o,h.gameTick),l()}function a(e,t){var t=t?"hidden":"",a=h.units[e],r=a.desc?a.desc:"",o='<div class="col-4 '+t+'" id="level-'+e+'"><div class="col-12 game-unit"><h4>'+a.name+' <small style="color: #CE0000" class="value-'+e+'"></small></h4><div class="col-6"><h1 id="count-'+e+'" style="padding: 50px;">0</h1></div><div class="col-6 align-center game-unit-image-container"><img src="/img/gravelock/'+(e+1)+'.png" class="game-unit-game" alt="" /><h3><span id="ap-'+e+'">'+a.ap+'</span> - <span id="cd-'+e+'">'+a.cd+'</span> - <span id="hp-'+e+'">'+a.hp+'</span></h3></div><div class="form-element align-center"><button id="summon-'+e+'" data-level="'+e+'" class="btn">Summon '+a.shortName+' <span class="price">('+i(a.price,"","")+'g)</span></button><div class="col-12"><button id="xTimes-5-'+e+'" data-level="'+e+'" data-times="5" class="btn">x5 <span class="price">('+i(d(a.price,5),"","")+'g)</span></button><button id="xTimes-25-'+e+'" data-level="'+e+'" data-times="25" class="btn">x25 <span class="price">('+i(d(a.price,25),"","")+'g)</span></button><button id="xTimes-100-'+e+'" data-level="'+e+'" data-times="100" class="btn">x100 <span class="price">('+i(d(a.price,100),"","")+'g)</span></button></div><div class="align-center col-12" id="raw-'+e+'"></div><p id="desc-'+e+'"class="align-center col-12">'+r+'</p><p style="color: #ffeb04;" id="bonus-'+e+'" class="align-center col-12"></p></div></div></div>';return o}function r(e,t){var t=t?"hidden":"",a=h.spells[e],r=a.desc?a.desc:"",o='<div class="col-4 '+t+'" id="spell-level-'+e+'"><div class="col-12 game-spell"><h4>'+a.name+'</h4><div class="col-12 align-center"><img src="/img/gravelock/s'+(e+1)+'.png" alt="" /></div><div class="form-element align-center"><button id="cast-'+e+'" data-level="'+e+'" class="btn">Cast '+a.shortName+' <span class="price">('+i(a.price,""," ")+h.player.resouceName[a.resource]+')</span></button><p id="spell-desc-'+e+'"class="align-center col-12">'+r+'</p><p style="color: #ffeb04;" id="spell-bonus-'+e+'" class="align-center col-12"></p></div></div></div>';return o}function o(){for(var e=0,t=0,a=h.gameTick/h.gameSpeed,r=0;r<h.totalUnits;r++)e+=h.units[r].ap/a/(h.units[r].cd/a)*h.units[r].count,t+=h.units[r].ap/h.units[r].cd*h.units[r].count;h.player.gold+=e/(h.player.idolHealth/a)*h.player.idolKillReward,h.player.goldSec=Math.round(t/h.player.idolHealth*h.player.idolKillReward);for(var r=0;r<h.totalUnits;r++){var o=h.units[r];o.count>0&&o.clockEffect&&"function"==typeof o.clockEffect&&($("#bonus-"+r).text("Bonus: "+o.clockEffect(o.count)),o.hasIdle&&(h.idle?$("#desc-"+r).find(".effect").css("color","#88b837"):$("#desc-"+r).find(".effect").css("color","#CE0000")))}h.clock++;for(var r=0;r<h.totalSpells;r++){var c=h.spells[r];c.cooldown&&!c.cooldown<=0&&c.cooldown--,c.clockEffect&&"function"==typeof c.clockEffect&&$("#spell-bonus-"+r).text("Cooldown: "+c.clockEffect())}h.clock>=h.clockReset&&(h.idle=!0,h.clock=0),l()}function c(e){e?($("#game-gold").removeClass("col-6"),$("#game-gold").addClass("col-4"),$("#game-dps").removeClass("col-6"),$("#game-dps").addClass("col-4"),$("#game-res").show()):($("#game-gold").removeClass("col-4"),$("#game-gold").addClass("col-6"),$("#game-dps").removeClass("col-4"),$("#game-dps").addClass("col-6"),$("#game-res").hide())}function l(){var e=Math.round(h.player.gold),t=h.player.goldSec;$("#gold").text(i(e,""," g")+" "+i(t,"(","g/Sec)"));for(var a=0,r=0;r<h.totalSpells;r++){var o=h.spells[r];s(h.player.res.energy,"#cast-"+r,o.price,!1)}h.player.res.energy>0&&c(!0),$("#res-energy").text(i(h.player.res.energy,"",""));for(var l=0,r=0;r<h.totalUnits;r++){var n=h.units[r];$("#count-"+r).text(i(n.count,"","x"));var u=n.ap/n.cd*n.count;a+=u,$(".value-"+r).text(i(u,""," DPS")),$("#raw-"+r).text(i(n.ap/n.cd,"","")+" Raw DPS"),$("#ap-"+r).text(i(n.ap,"","")),$("#cd-"+r).text(i(n.cd,"","")),$("#hp-"+r).text(i(n.hp,"","")),$("#summon-"+r).find(".price").text(i(Math.round(n.price),"(","g)")),$("#xTimes-5-"+r).find(".price").text(i(Math.round(d(n.price,5)),"(","g)")),$("#xTimes-25-"+r).find(".price").text(i(Math.round(d(n.price,25)),"(","g)")),$("#xTimes-100-"+r).find(".price").text(i(Math.round(d(n.price,100)),"(","g)")),s(h.player.gold,"#summon-"+r,n.price,!1),s(h.player.gold,"#xTimes-5-"+r,d(n.price,5),!0),s(h.player.gold,"#xTimes-25-"+r,d(n.price,25),!0),s(h.player.gold,"#xTimes-100-"+r,d(n.price,100),!0),l+=n.count,n.count>0&&$("#level-"+(r+1))&&$("#level-"+(r+1)).show()}a>h.ascend?($("#game-shards-gain").text(i(l/h.ascendShards,"","")),$("#game-ascend-box").show()):$("#game-ascend-box").hide(),$("#total_dps").html(h.idle?i(a,""," DPS <span style='color: #88b837'>(Idle)</span>"):i(a,""," DPS"))}function s(e,t,a,r){e>=a?($(t).addClass("success"),$(t).removeClass("danger"),r&&$(t).show()):($(t).removeClass("success"),$(t).addClass("danger"),r&&$(t).hide())}function i(e,t,a){for(var r=["","k","m","b","t","Qa","Qi","Sx","Sp","Oc","No","De","Un","Du","Tr","Qat","Qit","Sxd","Spd","Ocd","Nod","Vi","Unvi","Trvi","Qavi","Qivi","Ss","damn","omg","woho","a lot"],o=r.length;o>0;o--){if(!(e<Math.pow(10,1e3)))return t+Math.round(e/Math.pow(10,1e3))+"Googolplex"+a;if(!(e<Math.pow(10,100)))return t+Math.round(e/Math.pow(10,100))+"Googol"+a;if(e>Math.pow(10,3*o+1))return t+Math.round(e/Math.pow(10,3*o)*10)/10+r[o]+a}return t+Math.round(e)+a}function n(){if(h.debugMode){h.debugMode=!1,h.priceMultiplyer=1.15;for(var e=0;e<h.totalUnits;e++)h.units[e].price=h.units[e].basePrice}else{h.debugMode=!0,h.priceMultiplyer=0;for(var e=0;e<h.totalUnits;e++)h.units[e].price=0}}function d(e,t){var a=h.priceMultiplyer;t=Number(t);var r=e*Math.pow(a,t+.5-1)/Math.log(a)-e*Math.pow(a,-0.5)/Math.log(a);return r}function u(e,t,a){var r=h.units[e];if(t>1)var o=Number(d(r.price,t,"",""));else var o=Number(r.price);if(h.player.gold>=o||a){for(var e=0;e<h.totalUnits;e++){var c=h.units[e];c.clock&&(c.clock=0)}r.count+=t,a||(h.player.gold-=o,h.idle=!1,h.clock=0),t>1?r.price=r.price*Math.pow(h.priceMultiplyer,t):r.price*=h.priceMultiplyer,r.effect&&"function"==typeof r.effect&&r.effect(r.effectValue*t),$(this).find(".price").text(i(d(r.price,t),"(","g)")),l()}}function p(e,t){var a=h.spells[e];(h.player.res.energy>=a.price||t)&&(t||(h.idle=!1,h.clock=0,a.cooldown?a.cooldown<=0&&(h.player.res.energy-=a.price):h.player.res.energy-=a.price),a.effect&&"function"==typeof a.effect&&a.effect(),l())}function f(){$.ajax({type:"POST",url:"/view/admin/ajax/gravelock_reset.php"}).done(function(){location.reload()}).fail(function(){console.log("Failed while saving game, with error: "+data),$("#save-notify").text("Failed to save Game")}).always(function(e){console.log("Request done.")})}function m(){for(var e={player:h.player,units:[]},t=0;t<h.totalUnits;t++){var a={price:h.units[t].price,ap:h.units[t].ap,cd:h.units[t].cd,hp:h.units[t].hp,count:h.units[t].count};e.units[t]=a}$.ajax({type:"POST",url:"/view/admin/ajax/gravelock.php",data:{json:e}}).done(function(e){e?($("#save-notify").text("Game Saved"),$("#save-game").addClass("success"),$("#save-game").removeClass("danger"),setTimeout(function(){$("#save-game").addClass("danger"),$("#save-game").removeClass("success"),$("#save-notify").text("")},3e3),setTimeout(function(){m()},6e4)):console.log("Error while saving game: "+e)}).fail(function(){console.log("Failed while saving game, with error: "+data),$("#save-notify").text("Failed to save Game")}).always(function(e){console.log("Request done.")})}function g(){$.ajax({type:"POST",url:"/view/admin/ajax/gravelock_load.php",data:{json:JSON}}).done(function(e){if(e){if(e.length>10){e=jQuery.parseJSON(e),h.player.gold=Number(e.player.gold),h.player.res.energy=Number(e.player.res.energy),h.player.res.growth=Number(e.player.res.growth),h.player.res.decay=Number(e.player.res.decay),h.player.res.order=Number(e.player.res.order),h.player.res.wild=Number(e.player.res.wild);for(var t=0;t<h.totalUnits;t++)h.units[t].price=Number(e.units[t].price),h.units[t].ap=Number(e.units[t].ap),h.units[t].cd=Number(e.units[t].cd),h.units[t].hp=Number(e.units[t].hp),h.units[t].count=Number(e.units[t].count);$("#save-notify").text("Game Loaded")}h.gameLoaded=!0}else console.log("Error while saving game: ")}).fail(function(){console.log("Failed while saving game, with error: "+data)}).always(function(e){console.log("Request done.")})}var v={growth:0,energy:1,decay:2,order:3,wild:4},h=function(){var t={gameTick:100,gameSpeed:1e3,priceMultiplyer:1.15,unitPriceMultiplyer:6,totalUnits:0,totalSpells:0,debugMode:!1,idle:!1,gameLoaded:!1,ascendShards:1e3,ascend:Math.pow(10,43),clock:0,clockReset:100,player:{level:0,gold:3,shards:0,idol:0,goldSec:0,idolHealth:10,idolKillReward:20,res:{growth:0,energy:0,decay:0,order:0,wild:0},resouceName:{0:"Growth",1:"Energy",3:"Decay",4:"Order",5:"Wild"}},units:[{name:"Gravelock Raider",shortName:"Raider",elderBoost:!0,tier1:0,tier2:1e3,tier3:3e3,price:3,basePrice:3,ap:1,cd:2,hp:2,count:0,round:0},{name:"Gravelock Guard",shortName:"Guard",elderBoost:!0,tier1:1e3,tier2:3e3,tier3:9e3,price:18,basePrice:18,ap:2,cd:2,hp:3,count:0,round:0},{name:"Gravelock Outcast",shortName:"Outcast",elderBoost:!0,tier1:3e3,tier2:9e3,tier3:27e3,price:108,basePrice:18,ap:3,cd:2,hp:3,count:0,round:0},{name:"Lockling Brood",shortName:"Locklings",elderBoost:!0,tier1:6e3,tier2:18e3,tier3:54e3,price:648,basePrice:18,ap:4,cd:1,hp:4,count:0,round:0},{name:"Snargl",shortName:"Snargl",tier1:6e3,tier2:18e3,tier3:54e3,price:839808,basePrice:18,ap:4,cd:2,hp:5,count:0,round:0,hasIdle:!0,desc:"<span class='effect' style='color: #ffeb04;'>[Idle]</span>: Attack increases by 10",clockEffect:function(e){var a=t.units[4];return t.idle?(a.ap=14,"+"+10*a.count+" Attack"):(a.ap=4,"0 Attack")}},{name:"Gravelock Freak",shortName:"Freak",elderBoost:!0,tier1:6e3,tier2:18e3,tier3:54e3,price:3888,basePrice:18,ap:3,cd:2,hp:6,count:0,round:0,desc:"Deals additional damage per round equal to its health.",clockEffect:function(e){var a=t.units[5],r=a.hp/a.cd,o=t.gameTick/t.gameSpeed,c=r/(t.player.idolHealth/o)*t.player.idolKillReward;return t.player.gold+=c,i(r,"","DPS")}},{name:"Gravelock Elder",shortName:"Elder",effectValue:1,tier1:6e3,tier2:18e3,tier3:54e3,price:23328,basePrice:18,ap:3,cd:2,hp:5,count:0,round:0,desc:"Increases attack and health of all Gravelocks by 1.",effect:function(e){for(var a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap+=Number(e),r.hp+=Number(e))}}},{name:"Uhu Longnose",shortName:"Uhu",elderBoost:!0,effectValue:2,tier:1,tier1:6e3,tier2:18e3,tier3:54e3,price:139968,basePrice:18,ap:2,cd:2,hp:4,count:0,round:0,desc:"Increases your gold each round by the number of units you control.",clockEffect:function(e){for(var a=0,r=0;r<t.totalUnits;r++){var o=t.units[r];a+=o.count*e}return a-=t.units[7].count,t.player.gold+=a/10,i(a,"","G/s")}},{name:"Snargl Omelette",shortName:"Omelette",tier:1,tier1:6e3,tier2:18e3,tier3:54e3,price:5038848,basePrice:18,ap:0,cd:15,hp:4,count:0,round:0,clock:0,clockReset:600,lastUnit:"",desc:"Spawns a random Unit of lower level every 60 sec",clockEffect:function(a){var r=t.units[8];if(r.clock++,r.clock>=r.clockReset){var o=parseInt(e(0,7));r.lastUnit=r.count+"x "+t.units[o].name,u(o,r.count,!0),r.clock=0}var c=Number((r.clockReset-r.clock)/10)+1;return r.lastUnit+" ("+c+"s)"}},{name:"Desert Memorial",shortName:"Memorial",tier:1,tier1:0,tier2:0,tier3:0,price:0,basePrice:0,ap:0,cd:3,hp:4,count:0,round:0,clock:0,clockReset:200,lastUnit:"",desc:"Increase Energy by 1, every 20 sec",clockEffect:function(e){var a=t.units[9];a.clock++,a.clock>=a.clockReset&&(t.player.res.energy+=a.count,a.clock=0);var r=Number((a.clockReset-a.clock)/10)+1;return"+"+a.count+" Energy ("+r+"s)"}},{name:"Sand Pack Memorial",shortName:"Memorial",tier:1,tier1:0,tier2:0,tier3:0,price:0,basePrice:0,ap:0,cd:3,hp:4,count:0,round:0,clock:0,clockReset:250,lastUnit:"",desc:"Increase Energy by 5, every 25 sec",clockEffect:function(e){var a=t.units[10];a.clock++,a.clock>=a.clockReset&&(t.player.res.energy+=5*a.count,a.clock=0);var r=Number((a.clockReset-a.clock)/10)+1;return"+"+5*a.count+" Energy ("+r+"s)"}}],spells:[{name:"Gravelock Burrows",shortName:"Burrows",tier:1,tier2:0,tier3:0,price:50,resource:v.energy,basePrice:0,desc:"All Gravelocks get +3 Attack",effect:function(){for(var e=t.spells[0],a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap+=3)}}},{name:"Power Trip",shortName:"Power Trip",tier:1,tier2:0,tier3:0,price:10,resource:v.energy,basePrice:0,cooldown:600,cooldownReset:600,desc:"<span style='color: #ffeb04;'>[Cooldown]</span> Increase Energy by 20",effect:function(){var e=t.spells[1];e.cooldown<=0&&(t.player.res.energy+=20,e.cooldown=e.cooldownReset)},clockEffect:function(){var e=t.spells[1];return e.cooldown<=0?"Ready":Number(e.cooldown/10)+1+"sec"}},{name:"Fodder Pit",shortName:"Fodder Pit",tier:1,tier2:0,tier3:0,price:2e3,resource:v.energy,basePrice:0,desc:"Increese Gravelocks attack",effect:function(){for(var e=t.spells[2],a=0;a<t.totalUnits;a++){var r=t.units[a];r.elderBoost&&(r.ap*=1.25)}}}]};return t}();t(),setInterval(function(){h.gameLoaded&&m()},6e5),$("#debug").click(function(){n()}),$("[id*=cast-]").click(function(){var e=Number($(this).attr("data-level"));p(e,!1)}),$("[id*=summon-]").click(function(){var e=Number($(this).attr("data-level"));u(e,1,!1)}),$("[id*=xTimes-]").click(function(){var e=Number($(this).attr("data-level")),t=Number($(this).attr("data-times"));u(e,t,!1)}),$("#save-game").click(function(){m()}),$("#reset-game").click(function(){f()}),$("[class*=menu-toggle]").click(function(){var e=$(this).attr("data-show"),t=$(this).attr("data-hide");$("[name*='"+t+"']").hide(),$("#"+e).show()})});